<script>
const cat = document.getElementById("cat");
const pupils = document.querySelectorAll(".pupil");
const logo = document.getElementById("logo");

let offsetX, offsetY, dragging = false;
let hiding = false;

// ---- Eyes follow mouse ----
document.addEventListener("mousemove", e => {
  pupils.forEach(pupil => {
    const rect = pupil.getBoundingClientRect();
    const dx = e.clientX - (rect.left + rect.width / 2);
    const dy = e.clientY - (rect.top + rect.height / 2);
    const angle = Math.atan2(dy, dx);
    const x = Math.cos(angle) * 5;
    const y = Math.sin(angle) * 5;
    pupil.style.transform = `translate(${x}px, ${y}px)`;
  });

  // ---- Hide in logo if mouse is too close ----
  const catRect = cat.getBoundingClientRect();
  const catCenterX = catRect.left + catRect.width/2;
  const catCenterY = catRect.top + catRect.height/2;
  const distX = e.clientX - catCenterX;
  const distY = e.clientY - catCenterY;
  const distance = Math.sqrt(distX*distX + distY*distY);

  if (distance < 120 && !hiding) {
    const logoRect = logo.getBoundingClientRect();
    cat.style.left = (logoRect.left + logoRect.width/2 - 50) + "px";
    cat.style.top = (logoRect.top + logoRect.height/2 - 50) + "px";
    cat.style.opacity = "0";
    hiding = true;

    setTimeout(() => {
      cat.style.transition = "left 1.5s ease, top 1.5s ease, opacity 1s ease";
      cat.style.opacity = "1";
      cat.style.left = (logoRect.right - 40) + "px";
      cat.style.top = (logoRect.top + logoRect.height/2 - 50) + "px";
    }, 1200);
  } 
  else if (distance >= 180 && hiding) {
    hiding = false;
  }
});

// ---- Dragging ----
cat.addEventListener("mousedown", e => {
  dragging = true;
  offsetX = e.clientX - cat.offsetLeft;
  offsetY = e.clientY - cat.offsetTop;
  cat.style.transition = "none";
});
document.addEventListener("mousemove", e => {
  if (dragging) {
    cat.style.left = (e.clientX - offsetX) + "px";
    cat.style.top = (e.clientY - offsetY) + "px";
  }
});
document.addEventListener("mouseup", () => {
  dragging = false;
  cat.style.transition = "left 0.8s ease, top 0.8s ease, opacity 0.5s ease";
});

// ---- Pet bounce ----
cat.addEventListener("click", () => {
  cat.style.animation = "purr 0.4s ease";
  setTimeout(() => cat.style.animation = "breathe 3s infinite ease-in-out", 400);
});

// ---- Random pop-up ----
function randomPopUp() {
  if (!dragging && !hiding) {  // only if not dragging or hiding
    const screenW = window.innerWidth - 100;
    const screenH = window.innerHeight - 100;
    const randomX = Math.random() * screenW;
    const randomY = Math.random() * screenH;

    cat.style.transition = "left 0.8s ease, top 0.8s ease, opacity 0.5s ease";
    cat.style.left = randomX + "px";
    cat.style.top = randomY + "px";
  }
  // schedule next pop-up
  setTimeout(randomPopUp, 4000 + Math.random() * 3000); 
}

// start random movement
setTimeout(randomPopUp, 3000);
</script>
